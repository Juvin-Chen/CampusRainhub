# æ ¡å›­æ™ºèƒ½é›¨å…·å…±äº«ç³»ç»Ÿ - è¯¦ç»†è®¾è®¡ä¸åˆ†æ

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#ç³»ç»Ÿæ¶æ„è®¾è®¡)
3. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
4. [åç«¯è®¾è®¡](#åç«¯è®¾è®¡)
5. [å‰ç«¯è®¾è®¡](#å‰ç«¯è®¾è®¡)
6. [æ ¸å¿ƒä¸šåŠ¡æµç¨‹](#æ ¸å¿ƒä¸šåŠ¡æµç¨‹)
7. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)
8. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

---

## ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

æ ¡å›­æ™ºèƒ½é›¨å…·å…±äº«ç³»ç»Ÿæ—¨åœ¨è§£å†³é«˜æ ¡å¸ˆç”Ÿçªé‡é™é›¨æ—¶çš„å‡ºè¡Œç—›ç‚¹ï¼Œé€šè¿‡ç±»ä¼¼"å…±äº«å……ç”µå®"çš„æ¨¡å¼ï¼Œå®ç°æ ¡å›­é›¨å…·çš„ **24å°æ—¶æ— äººå€¼å®ˆ** å€Ÿè¿˜æœåŠ¡ã€‚

### 1.2 ç³»ç»Ÿç›®æ ‡

- **ç”¨æˆ·ç«¯**ï¼šæä¾›ä¾¿æ·çš„è‡ªåŠ©å€Ÿè¿˜æœåŠ¡ï¼Œæ”¯æŒå¤šç»ˆç«¯å¹¶å‘ç™»å½•
- **ç®¡ç†ç«¯**ï¼šæä¾›å®Œæ•´çš„è¿è¥ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬é›¨å…·è°ƒåº¦ã€ç«™ç‚¹ç›‘æ§å’Œæ•°æ®ç»Ÿè®¡
- **æŠ€æœ¯ç›®æ ‡**ï¼šé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œç¡®ä¿ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§

### 1.3 æŠ€æœ¯æ ˆ

- **å¼€å‘è¯­è¨€**ï¼šC++17
- **UIæ¡†æ¶**ï¼šQt 6.9.3 (Widgets)
- **æ•°æ®åº“**ï¼šMySQL 8.0
- **æ„å»ºå·¥å…·**ï¼šCMake 3.16+
- **ç¼–è¯‘å™¨**ï¼šMinGW 11.2+ æˆ– MSVC 2019+

---

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨ç»å…¸çš„**åˆ†å±‚æ¶æ„**ï¼ˆLayered Architectureï¼‰ï¼Œå°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®å’Œè¡¨ç°å±‚æ¸…æ™°åˆ†ç¦»ï¼š

**æ¶æ„å±‚æ¬¡ç»“æ„ï¼š**

```
è¡¨ç°å±‚ (UI Layer)
â”œâ”€â”€ å®¢æˆ·ç«¯UI (Client UI)
â””â”€â”€ ç®¡ç†ç«¯UI (Admin UI)
         â†“
ä¸šåŠ¡é€»è¾‘å±‚ (Service Layer)
â”œâ”€â”€ AuthService      (è®¤è¯æœåŠ¡)
â”œâ”€â”€ BorrowService    (å€Ÿè¿˜æœåŠ¡)
â””â”€â”€ StationService   (ç«™ç‚¹æœåŠ¡)
         â†“
æ•°æ®è®¿é—®å±‚ (DAO Layer)
â”œâ”€â”€ UserDao      (ç”¨æˆ·æ•°æ®è®¿é—®)
â”œâ”€â”€ GearDao      (é›¨å…·æ•°æ®è®¿é—®)
â”œâ”€â”€ StationDao   (ç«™ç‚¹æ•°æ®è®¿é—®)
â””â”€â”€ RecordDao    (è®°å½•æ•°æ®è®¿é—®)
         â†“
æ•°æ®æ¨¡å‹å±‚ (Model Layer)
â”œâ”€â”€ User         (ç”¨æˆ·æ¨¡å‹)
â”œâ”€â”€ RainGear     (é›¨å…·æ¨¡å‹)
â””â”€â”€ Stationlocal (ç«™ç‚¹æ¨¡å‹)
         â†“
æ•°æ®åº“ (MySQL)
```

### 2.2 æ¶æ„ä¼˜åŠ¿

1. **èŒè´£åˆ†ç¦»**ï¼šæ¯ä¸€å±‚åªè´Ÿè´£è‡ªå·±çš„èŒè´£ï¼Œé™ä½è€¦åˆåº¦
2. **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥ç‹¬ç«‹æµ‹è¯•æ¯ä¸€å±‚çš„åŠŸèƒ½
3. **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹æŸä¸€å±‚ä¸å½±å“å…¶ä»–å±‚
4. **å¯æ‰©å±•æ€§**ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„Serviceæˆ–DAO

---

## æ•°æ®åº“è®¾è®¡

### 3.1 æ•°æ®åº“æ¦‚è¿°

æ•°æ®åº“åç§°ï¼š`rainhub_db`  
å­—ç¬¦é›†ï¼š`utf8mb4`  
å­˜å‚¨å¼•æ“ï¼š`InnoDB`

### 3.2 æ•°æ®è¡¨è®¾è®¡

#### 3.2.1 ç”¨æˆ·è¡¨ (users)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| user_id | VARCHAR(20) | ä¸»é”®ï¼Œå­¦å·¥å· |
| password | VARCHAR(64) | å¯†ç  |
| real_name | VARCHAR(20) | çœŸå®å§“å |
| role | INT | è§’è‰²ï¼š0=å­¦ç”Ÿ, 1=æ•™èŒå·¥, 9=ç®¡ç†å‘˜ |
| credit | DECIMAL(10,2) | è´¦æˆ·ä½™é¢ï¼Œé»˜è®¤0.00 |
| is_active | TINYINT(1) | æ˜¯å¦æ¿€æ´»ï¼š0=æœªæ¿€æ´», 1=å·²æ¿€æ´» |

**è®¾è®¡è¯´æ˜**ï¼š
- `is_active` å­—æ®µç”¨äºé¦–æ¬¡ç™»å½•æµç¨‹ï¼šæœªæ¿€æ´»ç”¨æˆ·éœ€è¦è®¾ç½®å¯†ç 
- `credit` ç”¨äºå­˜å‚¨æŠ¼é‡‘å’Œç§Ÿé‡‘ï¼Œæ”¯æŒå……å€¼åŠŸèƒ½

#### 3.2.2 ç«™ç‚¹è¡¨ (station)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| station_id | INT AUTO_INCREMENT | ä¸»é”®ï¼Œå¯¹åº” Station æšä¸¾ |
| name | VARCHAR(50) | ç«™ç‚¹åç§° |
| pos_x | FLOAT | åœ°å›¾Xåæ ‡ |
| pos_y | FLOAT | åœ°å›¾Yåæ ‡ |
| status | INT | åœ¨çº¿çŠ¶æ€ï¼š1=åœ¨çº¿, 0=ç¦»çº¿ |
| unavailable_slots | VARCHAR(50) | æ•…éšœæ§½ä½ï¼Œé€—å·åˆ†éš”ï¼Œå¦‚ "1,5,8" |

**è®¾è®¡è¯´æ˜**ï¼š
- `pos_x` å’Œ `pos_y` ç”¨äºåœ°å›¾å¯è§†åŒ–
- `unavailable_slots` å­˜å‚¨æ•…éšœæ§½ä½ï¼Œé¿å…ç”¨æˆ·é€‰æ‹©

#### 3.2.3 é›¨å…·è¡¨ (raingear)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| gear_id | VARCHAR(20) | ä¸»é”®ï¼ŒRFIDæ ‡è¯† |
| type_id | INT | ç±»å‹ï¼š1=æ™®é€šå¡‘æ–™ä¼, 2=é«˜è´¨é‡æŠ—é£ä¼, 3=ä¸“ç”¨é®é˜³ä¼, 4=é›¨è¡£ |
| station_id | INT | æ‰€å±ç«™ç‚¹IDï¼ˆå¤–é”®ï¼‰ |
| slot_id | INT | æ§½ä½ç¼–å·ï¼š1-12 |
| status | INT | çŠ¶æ€ï¼š0=Unknown, 1=Available, 2=Borrowed, 3=Broken |

**æ§½ä½åˆ†é…è§„åˆ™**ï¼š
- æ§½ä½ 1-4ï¼šæ™®é€šå¡‘æ–™ä¼
- æ§½ä½ 5-8ï¼šé«˜è´¨é‡æŠ—é£ä¼
- æ§½ä½ 9-10ï¼šä¸“ç”¨é®é˜³ä¼
- æ§½ä½ 11-12ï¼šé›¨è¡£

#### 3.2.4 å€Ÿè¿˜è®°å½•è¡¨ (record)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| record_id | BIGINT AUTO_INCREMENT | ä¸»é”® |
| user_id | VARCHAR(20) | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| gear_id | VARCHAR(20) | é›¨å…·IDï¼ˆå¤–é”®ï¼‰ |
| borrow_time | DATETIME | å€Ÿå‡ºæ—¶é—´ |
| return_time | DATETIME | å½’è¿˜æ—¶é—´ï¼ˆNULLè¡¨ç¤ºæœªå½’è¿˜ï¼‰ |
| cost | DECIMAL(10,2) | ä½¿ç”¨è´¹ç”¨ï¼Œé»˜è®¤0.00 |

**è®¾è®¡è¯´æ˜**ï¼š
- `return_time` ä¸º NULL è¡¨ç¤ºæœªå½’è¿˜ï¼Œç”¨äºæŸ¥è¯¢ç”¨æˆ·å½“å‰å€Ÿå‡ºçš„é›¨å…·
- `cost` åœ¨å½’è¿˜æ—¶è®¡ç®—å¹¶æ›´æ–°

### 3.3 ç´¢å¼•è®¾è®¡

- `users.role`ï¼šæŒ‰è§’è‰²æŸ¥è¯¢ç”¨æˆ·
- `raingear.station_id`ï¼šæŒ‰ç«™ç‚¹æŸ¥è¯¢é›¨å…·
- `raingear.status`ï¼šæŒ‰çŠ¶æ€æŸ¥è¯¢é›¨å…·
- `record.user_id`ï¼šæŸ¥è¯¢ç”¨æˆ·çš„å€Ÿè¿˜è®°å½•
- `record.gear_id`ï¼šæŸ¥è¯¢é›¨å…·çš„å€Ÿè¿˜å†å²

### 3.4 å¤–é”®çº¦æŸ

- `raingear.station_id` â†’ `station.station_id` (ON DELETE SET NULL)
- `record.user_id` â†’ `users.user_id` (ON DELETE RESTRICT)
- `record.gear_id` â†’ `raingear.gear_id` (ON DELETE RESTRICT)

---

## åç«¯è®¾è®¡

### 4.1 æ•°æ®æ¨¡å‹å±‚ (Model Layer)

#### 4.1.1 User ç±»

```cpp
class User {
    QString id;          // å­¦å·¥å·
    QString name;        // å§“å
    QString password;    // å¯†ç ï¼ˆåŠ å¯†åï¼‰
    int role;            // è§’è‰²
    double credit;      // ä½™é¢
    bool is_active;      // æ˜¯å¦æ¿€æ´»
};
```

#### 4.1.2 RainGear æŠ½è±¡åŸºç±»

é‡‡ç”¨**å·¥å‚æ¨¡å¼**å’Œ**å¤šæ€**è®¾è®¡ï¼š

```cpp
class RainGear {
    QString id;              // RFIDæ ‡è¯†
    GearType type;           // ç±»å‹
    GearStatus status;        // çŠ¶æ€
    Station station_id;       // æ‰€å±ç«™ç‚¹
    int slot_id;             // æ§½ä½
    
    // çº¯è™šå‡½æ•°ï¼Œå­ç±»å®ç°
    virtual double get_deposit() const = 0;
    virtual QString get_iconpath() const = 0;
};
```

**å­ç±»**ï¼š
- `StandardPlasticUmbrella`ï¼šæ™®é€šå¡‘æ–™ä¼ï¼ŒæŠ¼é‡‘10å…ƒ
- `PremiumWindproofUmbrella`ï¼šé«˜è´¨é‡æŠ—é£ä¼ï¼ŒæŠ¼é‡‘20å…ƒ
- `SunshadeUmbrella`ï¼šä¸“ç”¨é®é˜³ä¼ï¼ŒæŠ¼é‡‘15å…ƒ
- `Raincoat`ï¼šé›¨è¡£ï¼ŒæŠ¼é‡‘25å…ƒ

#### 4.1.3 æšä¸¾ç±»å‹

```cpp
enum class GearType {
    StandardPlastic = 1,    // æ™®é€šå¡‘æ–™ä¼
    PremiumWindproof = 2,   // é«˜è´¨é‡æŠ—é£ä¼
    Sunshade = 3,           // ä¸“ç”¨é®é˜³ä¼
    Raincoat = 4            // é›¨è¡£
};

enum class GearStatus {
    Available = 1,  // å¯ç”¨
    Borrowed = 2,   // å€Ÿå‡º
    Broken = 3      // æŸå
};

enum class Station {
    Wende, Library, Mingde, ...  // 14ä¸ªç«™ç‚¹
};
```

### 4.2 æ•°æ®è®¿é—®å±‚ (DAO Layer)

#### 4.2.1 è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªDAOåªè´Ÿè´£ä¸€ä¸ªå®ä½“çš„CRUDæ“ä½œ
- **æ— ä¸šåŠ¡é€»è¾‘**ï¼šDAOåªè´Ÿè´£æ•°æ®è®¿é—®ï¼Œä¸åŒ…å«ä¸šåŠ¡è§„åˆ™
- **è¿”å›æ ‡å‡†ç±»å‹**ï¼šä½¿ç”¨ `std::optional` å’Œ `std::vector` ç­‰æ ‡å‡†å®¹å™¨

#### 4.2.2 UserDao

```cpp
class UserDao {
    std::optional<User> selectById(QSqlDatabase& db, const QString& id);
    std::optional<User> selectByIdAndName(QSqlDatabase& db, const QString& id, const QString& name);
    bool updatePassword(QSqlDatabase& db, const QString& id, const QString& name, const QString& newPassword);
    bool updateBalance(QSqlDatabase& db, const QString& id, double amountChange);
    QVector<User> selectAll(QSqlDatabase& db);
};
```

#### 4.2.3 GearDao

```cpp
class GearDao {
    std::unique_ptr<RainGear> selectById(QSqlDatabase& db, const QString& id);
    std::vector<std::unique_ptr<RainGear>> selectByStation(QSqlDatabase& db, Station station);
    bool isSlotOccupied(QSqlDatabase& db, Station station, int slot_id);
    bool updateStatusAndLocation(QSqlDatabase& db, const QString& id, GearStatus status, Station station, int slot_id);
    // ... æ›´å¤šæ–¹æ³•
};
```

#### 4.2.4 StationDao

```cpp
class StationDao {
    std::vector<std::unique_ptr<Stationlocal>> selectAll(QSqlDatabase& db);
    std::unique_ptr<Stationlocal> selectById(QSqlDatabase& db, Station station);
    QMap<int, int> selectStationInventoryCounts(QSqlDatabase& db);
};
```

#### 4.2.5 RecordDao

```cpp
class RecordDao {
    std::optional<BorrowRecord> selectUnfinishedByUserId(QSqlDatabase& db, const QString& userId);
    bool addBorrowRecord(QSqlDatabase& db, const QString& userId, const QString& gearId);
    bool updateReturnInfo(QSqlDatabase& db, qint64 recordId, double cost);
    QVector<BorrowRecord> selectByUserId(QSqlDatabase& db, const QString& userId);
};
```

### 4.3 ä¸šåŠ¡é€»è¾‘å±‚ (Service Layer)

#### 4.3.1 AuthService - è®¤è¯æœåŠ¡

**èŒè´£**ï¼šå¤„ç†ç”¨æˆ·ç™»å½•ã€å¯†ç éªŒè¯ã€è´¦æˆ·æ¿€æ´»

```cpp
class AuthService {
public:
    enum class LoginStatus {
        SuccessNormal,      // éé¦–æ¬¡ç™»å½•
        SuccessFirstTime,   // é¦–æ¬¡ç™»å½•éœ€è®¾ç½®å¯†ç 
        UserNotFound,       // ç”¨æˆ·ä¸å­˜åœ¨
        NameMismatch,       // å§“åä¸åŒ¹é…
        DatabaseError,      // æ•°æ®åº“é”™è¯¯
        AdminNotAllowed     // ç®¡ç†å‘˜ä¸èƒ½åœ¨å®¢æˆ·ç«¯ç™»å½•
    };
    
    LoginStatus checkLogin(const QString& id, const QString& name);
    bool verifyPassword(const QString& id, const QString& password);
    bool activateUser(const QString& id, const QString& name, const QString& password);
};
```

**ä¸šåŠ¡æµç¨‹**ï¼š
1. ç”¨æˆ·è¾“å…¥å­¦å·å’Œå§“å
2. `checkLogin()` éªŒè¯å­¦å·å’Œå§“åæ˜¯å¦åŒ¹é…
3. æ£€æŸ¥ `is_active` å­—æ®µï¼š
   - æœªæ¿€æ´» â†’ è·³è½¬é¦–æ¬¡ç™»å½•é¡µé¢
   - å·²æ¿€æ´» â†’ è·³è½¬å¯†ç è¾“å…¥é¡µé¢
4. `verifyPassword()` éªŒè¯å¯†ç 
5. ç™»å½•æˆåŠŸï¼Œè¿”å›ç”¨æˆ·å¯¹è±¡

#### 4.3.2 BorrowService - å€Ÿè¿˜æœåŠ¡

**èŒè´£**ï¼šå¤„ç†å€Ÿä¼ã€è¿˜ä¼çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

```cpp
class BorrowService {
public:
    struct ServiceResult {
        bool success;
        QString message;
        double cost = 0.0;
    };
    
    ServiceResult borrowGear(const QString& userId, const QString& gearId);
    ServiceResult returnGear(const QString& userId, const QString& gearId, Station stationId, int slotId);
private:
    double calculateCost(const QDateTime& borrowTime, const QDateTime& returnTime, GearType type);
};
```

**å€Ÿä¼æµç¨‹**ï¼š
1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä¸”å·²æ¿€æ´»
2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æœªå½’è¿˜çš„è®¢å•
3. æ£€æŸ¥é›¨å…·æ˜¯å¦å­˜åœ¨ä¸”çŠ¶æ€ä¸º Available
4. æ£€æŸ¥ç”¨æˆ·ä½™é¢æ˜¯å¦è¶³å¤Ÿæ”¯ä»˜æŠ¼é‡‘
5. **å¼€å¯äº‹åŠ¡**ï¼š
   - æ‰£é™¤ç”¨æˆ·æŠ¼é‡‘
   - æ›´æ–°é›¨å…·çŠ¶æ€ä¸º Borrowed
   - åˆ›å»ºå€Ÿå‡ºè®°å½•
6. æäº¤äº‹åŠ¡æˆ–å›æ»š

**è¿˜ä¼æµç¨‹**ï¼š
1. éªŒè¯æ§½ä½æ˜¯å¦åˆæ³•ï¼ˆæ ¹æ®é›¨å…·ç±»å‹ï¼‰
2. æ£€æŸ¥æ§½ä½æ˜¯å¦è¢«å ç”¨
3. æŸ¥æ‰¾ç”¨æˆ·çš„æœªå½’è¿˜è®¢å•
4. éªŒè¯å½’è¿˜çš„é›¨å…·IDæ˜¯å¦åŒ¹é…
5. è®¡ç®—ä½¿ç”¨è´¹ç”¨ï¼ˆæŒ‰å°æ—¶è®¡è´¹ï¼‰
6. **å¼€å¯äº‹åŠ¡**ï¼š
   - æ›´æ–°è®°å½•ï¼ˆå½’è¿˜æ—¶é—´ã€è´¹ç”¨ï¼‰
   - æ›´æ–°é›¨å…·çŠ¶æ€ä¸º Availableï¼Œè®¾ç½®æ–°ä½ç½®
   - é€€è¿˜æŠ¼é‡‘ï¼ˆæ‰£é™¤è´¹ç”¨åï¼‰
7. æäº¤äº‹åŠ¡æˆ–å›æ»š

**è®¡è´¹è§„åˆ™**ï¼š
- æ™®é€šå¡‘æ–™ä¼ï¼š1å…ƒ/å°æ—¶
- é«˜è´¨é‡æŠ—é£ä¼ï¼š2å…ƒ/å°æ—¶
- ä¸“ç”¨é®é˜³ä¼ï¼š1.5å…ƒ/å°æ—¶
- é›¨è¡£ï¼š2å…ƒ/å°æ—¶
- è´¹ç”¨æœ€å¤šç­‰äºæŠ¼é‡‘ï¼Œä¸ä¼šå€’æ‰£ç”¨æˆ·ä½™é¢

#### 4.3.3 StationService - ç«™ç‚¹æœåŠ¡

**èŒè´£**ï¼šæä¾›ç«™ç‚¹ä¿¡æ¯æŸ¥è¯¢å’Œåº“å­˜ç»Ÿè®¡

```cpp
class StationService {
    std::vector<std::unique_ptr<Stationlocal>> getAllStations();
    std::unique_ptr<Stationlocal> getStationDetail(Station stationId);
    QMap<int, int> getStationInventoryCounts();
};
```

### 4.4 å·¥å…·å±‚ (Utils Layer)

#### 4.4.1 ConnectionPool - æ•°æ®åº“è¿æ¥æ± 

**è®¾è®¡**ï¼šé‡‡ç”¨**çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread-Local Storageï¼‰**æœºåˆ¶

```cpp
class ConnectionPool {
public:
    static QSqlDatabase getThreadLocalConnection();
    static void removeThreadConnection();
};
```

**å®ç°åŸç†**ï¼š
1. æ¯ä¸ªçº¿ç¨‹é€šè¿‡ `QThread::currentThreadId()` è·å–å”¯ä¸€æ ‡è¯†
2. ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥
3. è¿æ¥åæ ¼å¼ï¼š`Conn_{threadId}`
4. çº¿ç¨‹ç»“æŸæ—¶è°ƒç”¨ `removeThreadConnection()` æ¸…ç†

**ä¼˜åŠ¿**ï¼š
- **çº¿ç¨‹å®‰å…¨**ï¼šæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹è¿æ¥ï¼Œé¿å…å¹¶å‘å†²çª
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿æ¥å¤ç”¨ï¼Œå‡å°‘åˆ›å»º/é”€æ¯å¼€é”€
- **ç®€å•é«˜æ•ˆ**ï¼šæ— éœ€å¤æ‚çš„è¿æ¥æ± ç®¡ç†é€»è¾‘

---

## å‰ç«¯è®¾è®¡

### 5.1 UIæ¶æ„è®¾è®¡

#### 5.1.1 é¡µé¢ç®¡ç†æ¶æ„

é‡‡ç”¨ **QStackedWidget** å®ç°å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰æ¨¡å¼ï¼š

```cpp
class MainWindow : public QMainWindow {
    QStackedWidget *m_stack;  // é¡µé¢æ ˆ
    
    // Serviceå±‚ï¼ˆæŒæœ‰æ‰€æœ‰æƒï¼‰
    std::unique_ptr<AuthService> m_authService;
    std::unique_ptr<BorrowService> m_borrowService;
    std::unique_ptr<StationService> m_stationService;
    
    // å½“å‰ç™»å½•ç”¨æˆ·
    std::shared_ptr<User> m_currentUser;
    
    void switchPage(Page page);  // é¡µé¢åˆ‡æ¢
};
```

**é¡µé¢æšä¸¾**ï¼š
```cpp
enum class Page {
    Welcome = 0,      // æ¬¢è¿é¡µ
    CardRead,         // åˆ·å¡é¡µ
    UserInput,        // ç”¨æˆ·ä¿¡æ¯è¾“å…¥
    FirstLogin,       // é¦–æ¬¡ç™»å½•
    Login,            // å¯†ç ç™»å½•
    ResetPwd,         // é‡ç½®å¯†ç 
    Dashboard,        // ä¸»é¡µ
    Borrow,           // å€Ÿè¿˜é¡µ
    Map,              // åœ°å›¾é¡µ
    Profile,          // ä¸ªäººä¸­å¿ƒ
    Instruction       // ä½¿ç”¨è¯´æ˜
};
```

#### 5.1.2 ä¿¡å·æ§½æœºåˆ¶

ä½¿ç”¨ Qt çš„ä¿¡å·æ§½å®ç°é¡µé¢é—´é€šä¿¡ï¼š

```cpp
// ç™»å½•æˆåŠŸä¿¡å·
connect(m_loginPage, &LoginPage::loginSuccess, 
        this, &MainWindow::onLoginSuccess);

// å€Ÿè¿˜æ“ä½œå®Œæˆä¿¡å·
connect(m_borrowPage, &BorrowPage::operationCompleted,
        this, &MainWindow::refreshUserData);
```

### 5.2 é¡µé¢è®¾è®¡

#### 5.2.1 æ¬¢è¿é¡µ (WelcomePage)

**åŠŸèƒ½**ï¼šç³»ç»Ÿå…¥å£ï¼Œå±•ç¤ºæ¬¢è¿ä¿¡æ¯

**UIå…ƒç´ **ï¼š
- å¤§æ ‡é¢˜ï¼š"â˜” æ ¡å›­æ™ºèƒ½é›¨å…·å…±äº«ç³»ç»Ÿ"
- å¼€å§‹æŒ‰é’®ï¼šè¿›å…¥åˆ·å¡æµç¨‹
- ä½¿ç”¨è¯´æ˜é“¾æ¥

#### 5.2.2 è®¤è¯æµç¨‹é¡µé¢

**CardReadPageï¼ˆåˆ·å¡é¡µï¼‰**ï¼š
- æ¨¡æ‹Ÿæ ¡å›­ä¸€å¡é€šåˆ·å¡
- ç¡®è®¤æŒ‰é’®è¿›å…¥ä¸‹ä¸€æ­¥

**UserInputPageï¼ˆç”¨æˆ·ä¿¡æ¯è¾“å…¥ï¼‰**ï¼š
- è¾“å…¥å­¦å·å’Œå§“å
- è°ƒç”¨ `AuthService::checkLogin()` éªŒè¯
- æ ¹æ®ç»“æœè·³è½¬åˆ°é¦–æ¬¡ç™»å½•æˆ–å¯†ç ç™»å½•

**FirstLoginPageï¼ˆé¦–æ¬¡ç™»å½•ï¼‰**ï¼š
- è®¾ç½®æ–°å¯†ç ï¼ˆä¸¤æ¬¡è¾“å…¥ç¡®è®¤ï¼‰
- è°ƒç”¨ `AuthService::activateUser()` æ¿€æ´»è´¦æˆ·

**LoginPageï¼ˆå¯†ç ç™»å½•ï¼‰**ï¼š
- è¾“å…¥å¯†ç 
- è°ƒç”¨ `AuthService::verifyPassword()` éªŒè¯
- ç™»å½•æˆåŠŸåå‘å‡º `loginSuccess` ä¿¡å·

#### 5.2.3 ä¸»é¡µ (DashboardPage)

**åŠŸèƒ½**ï¼šç”¨æˆ·ç™»å½•åçš„ä¸»ç•Œé¢

**UIå¸ƒå±€ç»“æ„ï¼š**

```
ä¸»é¡µ (DashboardPage)
â”‚
â”œâ”€â”€ ç”¨æˆ·ä¿¡æ¯å¡ç‰‡
â”‚   â”œâ”€â”€ å§“åã€ä½™é¢
â”‚   â””â”€â”€ å½“å‰å€Ÿå‡ºçŠ¶æ€
â”‚
â”œâ”€â”€ å¿«é€Ÿæ“ä½œåŒº
â”‚   â”œâ”€â”€ [å€Ÿä¼] æŒ‰é’®
â”‚   â”œâ”€â”€ [è¿˜ä¼] æŒ‰é’®
â”‚   â””â”€â”€ [æŸ¥çœ‹åœ°å›¾] æŒ‰é’®
â”‚
â””â”€â”€ é™„è¿‘ç«™ç‚¹åˆ—è¡¨
    â”œâ”€â”€ ç«™ç‚¹åç§°ã€è·ç¦»
    â””â”€â”€ å¯ç”¨åº“å­˜æ•°é‡
```

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºç”¨æˆ·ä½™é¢å’Œå½“å‰å€Ÿå‡ºçŠ¶æ€
- å¿«é€Ÿè¿›å…¥å€Ÿä¼/è¿˜ä¼é¡µé¢
- æ˜¾ç¤ºé™„è¿‘ç«™ç‚¹åˆ—è¡¨ï¼ˆå®æ—¶åˆ·æ–°ï¼‰

#### 5.2.4 å€Ÿè¿˜é¡µ (BorrowPage)

**åŠŸèƒ½**ï¼šæ˜¾ç¤º12ä¸ªæ§½ä½ï¼Œæ”¯æŒå€Ÿä¼å’Œè¿˜ä¼æ“ä½œ

**UIè®¾è®¡**ï¼š
- **3Ã—4ç½‘æ ¼å¸ƒå±€**ï¼š12ä¸ªæ§½ä½å¡ç‰‡
- **çŠ¶æ€é¢œè‰²**ï¼š
  - ğŸŸ¢ ç»¿è‰²ï¼šå¯å€Ÿï¼ˆæœ‰é›¨å…·ä¸”çŠ¶æ€ä¸ºAvailableï¼‰
  - âšª ç°è‰²ï¼šç©ºæ§½å¯è¿˜ï¼ˆæ— é›¨å…·ï¼‰
  - ğŸ”´ çº¢è‰²ï¼šæ•…éšœï¼ˆæ§½ä½åœ¨unavailable_slotsä¸­ï¼‰

**äº¤äº’æµç¨‹**ï¼š

**å€Ÿä¼æ¨¡å¼**ï¼š
1. ç”¨æˆ·ç‚¹å‡»ç»¿è‰²æ§½ä½
2. ç³»ç»Ÿè·å–è¯¥æ§½ä½çš„é›¨å…·ID
3. è°ƒç”¨ `BorrowService::borrowGear()`
4. æ˜¾ç¤ºç»“æœæç¤º
5. åˆ·æ–°æ§½ä½çŠ¶æ€

**è¿˜ä¼æ¨¡å¼**ï¼š
1. ç”¨æˆ·ç‚¹å‡»ç°è‰²æ§½ä½
2. ç³»ç»Ÿè·å–ç”¨æˆ·å½“å‰å€Ÿå‡ºçš„é›¨å…·
3. éªŒè¯æ§½ä½æ˜¯å¦åˆæ³•ï¼ˆæ ¹æ®é›¨å…·ç±»å‹ï¼‰
4. è°ƒç”¨ `BorrowService::returnGear()`
5. æ˜¾ç¤ºè´¹ç”¨å’Œé€€æ¬¾ä¿¡æ¯
6. åˆ·æ–°æ§½ä½çŠ¶æ€

**è‡ªåŠ¨åˆ·æ–°**ï¼š
- ä½¿ç”¨ `QTimer` æ¯3ç§’åˆ·æ–°ä¸€æ¬¡æ§½ä½çŠ¶æ€
- ç¡®ä¿å¤šç”¨æˆ·å¹¶å‘æ—¶æ•°æ®å®æ—¶æ€§

#### 5.2.5 åœ°å›¾é¡µ (MapPage)

**åŠŸèƒ½**ï¼šå¯è§†åŒ–æ˜¾ç¤ºæ‰€æœ‰ç«™ç‚¹ä½ç½®å’Œåº“å­˜çŠ¶æ€

**è®¾è®¡**ï¼š
- ä½¿ç”¨ `QGraphicsView` ç»˜åˆ¶æ ¡å›­åœ°å›¾
- ç«™ç‚¹æ˜¾ç¤ºä¸ºåœ†å½¢æ ‡è®°
- **é¢œè‰²ç¼–ç **ï¼š
  - ç»¿è‰²ï¼šåº“å­˜å……è¶³ï¼ˆå¯ç”¨æ•°é‡ > 5ï¼‰
  - é»„è‰²ï¼šåº“å­˜ä¸­ç­‰ï¼ˆ2-5ä¸ªï¼‰
  - çº¢è‰²ï¼šåº“å­˜ä¸è¶³ï¼ˆ< 2ä¸ªï¼‰
  - ç°è‰²ï¼šç¦»çº¿çŠ¶æ€

**æ•°æ®åŠ è½½ç­–ç•¥**ï¼š
- **é™æ€æ•°æ®**ï¼šç«™ç‚¹åæ ‡ã€åç§°ä» `map_config.json` é¢„åŠ è½½
- **åŠ¨æ€æ•°æ®**ï¼šåº“å­˜æ•°é‡ä»æ•°æ®åº“å®æ—¶æŸ¥è¯¢
- æ··åˆåŠ è½½ç­–ç•¥é™ä½æ•°æ®åº“å‹åŠ›

#### 5.2.6 ä¸ªäººä¸­å¿ƒ (ProfilePage)

**åŠŸèƒ½**ï¼šæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œå€Ÿè¿˜è®°å½•

**å†…å®¹**ï¼š
- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆå­¦å·ã€å§“åã€è§’è‰²ã€ä½™é¢ï¼‰
- å€Ÿè¿˜è®°å½•åˆ—è¡¨ï¼ˆæ—¶é—´ã€é›¨å…·ç±»å‹ã€è´¹ç”¨ï¼‰
- é€€å‡ºç™»å½•æŒ‰é’®

### 5.3 ç»„ä»¶è®¾è®¡

#### 5.3.1 SlotItem - æ§½ä½ç»„ä»¶

**è®¾è®¡**ï¼šå¯å¤ç”¨çš„æ§½ä½æ˜¾ç¤ºç»„ä»¶

```cpp
class SlotItem : public QWidget {
    enum class State {
        Available,    // å¯å€Ÿ
        Empty,        // ç©ºæ§½
        Maintenance,  // æ•…éšœ
        Selected      // é€‰ä¸­
    };
    
    void setState(State state);
    void setIcon(const QPixmap &pixmap, const QString &descText);
signals:
    void clicked(int index, SlotItem::State state);
};
```

**æ ·å¼**ï¼šé€šè¿‡ QSS åŠ¨æ€åˆ‡æ¢æ ·å¼
- Availableï¼šç»¿è‰²è¾¹æ¡†ï¼Œç™½è‰²èƒŒæ™¯
- Emptyï¼šç°è‰²è¾¹æ¡†ï¼Œæµ…ç°èƒŒæ™¯
- Maintenanceï¼šçº¢è‰²è¾¹æ¡†ï¼Œæµ…çº¢èƒŒæ™¯

#### 5.3.2 æ ·å¼ç³»ç»Ÿ (Styles.h)

**è®¾è®¡ç†å¿µ**ï¼šç™½è‰²ç®€æ´ä¸»é¢˜ï¼Œå»é™¤AIé£æ ¼çš„æ¸å˜

**é¢œè‰²æ–¹æ¡ˆ**ï¼š
- ä¸»è‰²è°ƒï¼šç°è‰²ç³»ï¼ˆ#4a5568ï¼‰
- èƒŒæ™¯ï¼šçº¯ç™½è‰²ï¼ˆ#ffffffï¼‰
- è¾¹æ¡†ï¼šæµ…ç°è‰²ï¼ˆ#e2e8f0ï¼‰
- å¼ºè°ƒè‰²ï¼šä¿æŒåŠŸèƒ½è‰²ï¼ˆæˆåŠŸç»¿ã€è­¦å‘Šæ©™ã€å±é™©çº¢ï¼‰

**æ ·å¼å‘½åç©ºé—´**ï¼š
```cpp
namespace Styles {
    namespace Colors { ... }      // é¢œè‰²å¸¸é‡
    namespace Buttons { ... }      // æŒ‰é’®æ ·å¼
    namespace Labels { ... }       // æ ‡ç­¾æ ·å¼
    namespace SlotCard { ... }     // æ§½ä½å¡ç‰‡æ ·å¼
}
```

### 5.4 å‰ç«¯ä¸åç«¯äº¤äº’

#### 5.4.1 Serviceè°ƒç”¨æ¨¡å¼

å‰ç«¯é¡µé¢é€šè¿‡æŒ‡é’ˆæŒæœ‰Serviceå®ä¾‹ï¼š

```cpp
class BorrowPage : public QWidget {
    BorrowService *m_borrowService;  // ä¸æŒæœ‰æ‰€æœ‰æƒ
    
    void handleBorrow(int slotId) {
        auto result = m_borrowService->borrowGear(userId, gearId);
        if (result.success) {
            QMessageBox::information(this, "æˆåŠŸ", result.message);
        }
    }
};
```

#### 5.4.2 æ•°æ®åˆ·æ–°æœºåˆ¶

- **æ‰‹åŠ¨åˆ·æ–°**ï¼šç”¨æˆ·ç‚¹å‡»åˆ·æ–°æŒ‰é’®
- **è‡ªåŠ¨åˆ·æ–°**ï¼šå®šæ—¶å™¨å®šæœŸåˆ·æ–°ï¼ˆå€Ÿè¿˜é¡µã€åœ°å›¾é¡µï¼‰
- **äº‹ä»¶é©±åŠ¨åˆ·æ–°**ï¼šæ“ä½œå®Œæˆåè‡ªåŠ¨åˆ·æ–°ï¼ˆå¦‚å€Ÿä¼æˆåŠŸååˆ·æ–°ä½™é¢ï¼‰

---

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 6.1 ç”¨æˆ·ç™»å½•æµç¨‹

**ç”¨æˆ·ç™»å½•æµç¨‹ï¼š**

```
å¼€å§‹
  â”‚
  â”œâ”€â†’ æ¬¢è¿é¡µ
  â”‚     â”‚
  â”‚     â”œâ”€â†’ åˆ·å¡é¡µ
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â†’ ç”¨æˆ·ä¿¡æ¯è¾“å…¥
  â”‚     â”‚           â”‚
  â”‚     â”‚           â””â”€â†’ AuthService::checkLogin()
  â”‚     â”‚                     â”‚
  â”‚     â”‚                     â”œâ”€â†’ é¦–æ¬¡ç™»å½• (is_active=0)
  â”‚     â”‚                     â”‚     â”‚
  â”‚     â”‚                     â”‚     â”œâ”€â†’ é¦–æ¬¡ç™»å½•é¡µ
  â”‚     â”‚                     â”‚     â”‚     â”‚
  â”‚     â”‚                     â”‚     â”‚     â””â”€â†’ è®¾ç½®å¯†ç 
  â”‚     â”‚                     â”‚     â”‚           â”‚
  â”‚     â”‚                     â”‚     â”‚           â””â”€â†’ AuthService::activateUser()
  â”‚     â”‚                     â”‚     â”‚
  â”‚     â”‚                     â”‚     â””â”€â†’ å·²æ¿€æ´»ç”¨æˆ· (is_active=1)
  â”‚     â”‚                     â”‚           â”‚
  â”‚     â”‚                     â”‚           â”œâ”€â†’ å¯†ç ç™»å½•é¡µ
  â”‚     â”‚                     â”‚           â”‚     â”‚
  â”‚     â”‚                     â”‚           â”‚     â””â”€â†’ éªŒè¯å¯†ç 
  â”‚     â”‚                     â”‚           â”‚           â”‚
  â”‚     â”‚                     â”‚           â”‚           â””â”€â†’ AuthService::verifyPassword()
  â”‚     â”‚                     â”‚           â”‚
  â”‚     â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚     â”‚                               â”‚
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                      ç™»å½•æˆåŠŸ
                                          â”‚
                                      è¿›å…¥ä¸»é¡µ
```

### 6.2 å€Ÿä¼æµç¨‹

**å€Ÿä¼æµç¨‹ï¼š**

```
ç”¨æˆ·é€‰æ‹©ç«™ç‚¹å’Œæ§½ä½
  â”‚
  â””â”€â†’ BorrowService::borrowGear()
        â”‚
        â”œâ”€â†’ éªŒè¯ç”¨æˆ·çŠ¶æ€
        â”‚   â”œâ”€ ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä¸”å·²æ¿€æ´»
        â”‚   â””â”€ æ˜¯å¦æœ‰æœªå½’è¿˜è®¢å•
        â”‚
        â”œâ”€â†’ éªŒè¯é›¨å…·çŠ¶æ€
        â”‚   â”œâ”€ é›¨å…·æ˜¯å¦å­˜åœ¨
        â”‚   â””â”€ çŠ¶æ€æ˜¯å¦ä¸ºAvailable
        â”‚
        â””â”€â†’ éªŒè¯ä½™é¢
            â””â”€ ä½™é¢ >= æŠ¼é‡‘
                â”‚
                â””â”€â†’ å¼€å¯æ•°æ®åº“äº‹åŠ¡
                      â”‚
                      â”œâ”€â†’ æ‰£é™¤ç”¨æˆ·æŠ¼é‡‘ (UserDao::updateBalance)
                      â”‚
                      â”œâ”€â†’ æ›´æ–°é›¨å…·çŠ¶æ€ (GearDao::updateStatus)
                      â”‚
                      â””â”€â†’ åˆ›å»ºå€Ÿå‡ºè®°å½• (RecordDao::addBorrowRecord)
                            â”‚
                            â”œâ”€â†’ æäº¤äº‹åŠ¡ (æˆåŠŸ)
                            â”‚     â”‚
                            â”‚     â””â”€â†’ è¿”å›æˆåŠŸç»“æœ
                            â”‚
                            â””â”€â†’ å›æ»šäº‹åŠ¡ (å¤±è´¥)
                                  â”‚
                                  â””â”€â†’ è¿”å›å¤±è´¥ç»“æœ
```

### 6.3 è¿˜ä¼æµç¨‹

**è¿˜ä¼æµç¨‹ï¼š**

```
ç”¨æˆ·é€‰æ‹©ç«™ç‚¹å’Œæ§½ä½
  â”‚
  â””â”€â†’ BorrowService::returnGear()
        â”‚
        â”œâ”€â†’ éªŒè¯æ§½ä½åˆæ³•æ€§
        â”‚   â”œâ”€ æ ¹æ®é›¨å…·ç±»å‹åˆ¤æ–­æ§½ä½èŒƒå›´
        â”‚   â””â”€ æ£€æŸ¥æ§½ä½æ˜¯å¦è¢«å ç”¨
        â”‚
        â”œâ”€â†’ æŸ¥æ‰¾æœªå½’è¿˜è®¢å• (RecordDao::selectUnfinished)
        â”‚
        â””â”€â†’ éªŒè¯é›¨å…·IDåŒ¹é…
              â”‚
              â””â”€â†’ è®¡ç®—ä½¿ç”¨è´¹ç”¨ (calculateCost)
                    â”‚
                    â””â”€â†’ å¼€å¯æ•°æ®åº“äº‹åŠ¡
                          â”‚
                          â”œâ”€â†’ æ›´æ–°å€Ÿè¿˜è®°å½•
                          â”‚   â”œâ”€ å½’è¿˜æ—¶é—´
                          â”‚   â””â”€ ä½¿ç”¨è´¹ç”¨
                          â”‚
                          â”œâ”€â†’ æ›´æ–°é›¨å…·çŠ¶æ€å’Œä½ç½®
                          â”‚   â”œâ”€ çŠ¶æ€ï¼šBorrowed â†’ Available
                          â”‚   â””â”€ è®¾ç½®æ–°ç«™ç‚¹å’Œæ§½ä½
                          â”‚
                          â””â”€â†’ é€€è¿˜æŠ¼é‡‘ï¼ˆæ‰£é™¤è´¹ç”¨ï¼‰(UserDao::updateBalance)
                                â”‚
                                â””â”€â†’ æäº¤äº‹åŠ¡
                                      â”‚
                                      â””â”€â†’ è¿”å›ç»“æœï¼ˆè´¹ç”¨ã€é€€æ¬¾é‡‘é¢ï¼‰
```

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### 7.1 äº‹åŠ¡ç®¡ç†

æ‰€æœ‰æ¶‰åŠå¤šè¡¨æ›´æ–°çš„æ“ä½œéƒ½ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ï¼š

```cpp
if (!db.transaction()) {
    return {false, "äº‹åŠ¡å¼€å¯å¤±è´¥"};
}

bool success = true;
if (!operation1()) success = false;
if (!operation2()) success = false;
if (!operation3()) success = false;

if (success) {
    db.commit();
    return {true, "æ“ä½œæˆåŠŸ"};
} else {
    db.rollback();
    return {false, "æ“ä½œå¤±è´¥"};
}
```

**ä¼˜åŠ¿**ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚

### 7.2 å·¥å‚æ¨¡å¼ - é›¨å…·åˆ›å»º

```cpp
class RainGearFactory {
public:
    static std::unique_ptr<RainGear> create(
        const QString& id, 
        GearType type, 
        GearStatus status, 
        Station station, 
        int slot
    ) {
        switch (type) {
            case GearType::StandardPlastic:
                return std::make_unique<StandardPlasticUmbrella>(id, status, station, slot);
            case GearType::PremiumWindproof:
                return std::make_unique<PremiumWindproofUmbrella>(id, status, station, slot);
            // ... å…¶ä»–ç±»å‹
        }
    }
};
```

**ä¼˜åŠ¿**ï¼šå°è£…å¯¹è±¡åˆ›å»ºé€»è¾‘ï¼Œä¾¿äºæ‰©å±•æ–°çš„é›¨å…·ç±»å‹ã€‚

### 7.3 å¼‚å¸¸å¤„ç†

- **æ•°æ®åº“è¿æ¥å¤±è´¥**ï¼šè¿”å›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
- **SQLæ‰§è¡Œå¤±è´¥**ï¼šè®°å½•æ—¥å¿—å¹¶å›æ»šäº‹åŠ¡
- **ä¸šåŠ¡é€»è¾‘éªŒè¯å¤±è´¥**ï¼šè¿”å›å‹å¥½çš„æç¤ºä¿¡æ¯

### 7.4 æ—¥å¿—è®°å½•

ä½¿ç”¨ Qt çš„ `qDebug()`, `qInfo()`, `qWarning()`, `qCritical()` åˆ†çº§è®°å½•ï¼š
- ä¿¡æ¯æ—¥å¿—ï¼šè¿æ¥æˆåŠŸã€æ“ä½œæˆåŠŸ
- è­¦å‘Šæ—¥å¿—ï¼šæ•°æ®å¼‚å¸¸ä½†å¯æ¢å¤
- é”™è¯¯æ—¥å¿—ï¼šæ“ä½œå¤±è´¥ã€äº‹åŠ¡å›æ»š

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 8.1 æ•°æ®åº“ä¼˜åŒ–

1. **è¿æ¥æ± **ï¼šçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºè¿æ¥
2. **ç´¢å¼•ä¼˜åŒ–**ï¼šåœ¨å¸¸ç”¨æŸ¥è¯¢å­—æ®µä¸Šå»ºç«‹ç´¢å¼•
3. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šåªæŸ¥è¯¢å¿…è¦å­—æ®µï¼Œé¿å… `SELECT *`

### 8.2 å‰ç«¯ä¼˜åŒ–

1. **é¡µé¢æ‡’åŠ è½½**ï¼šé¡µé¢åœ¨éœ€è¦æ—¶æ‰åˆ›å»º
2. **æ•°æ®ç¼“å­˜**ï¼šé™æ€æ•°æ®ï¼ˆç«™ç‚¹åæ ‡ï¼‰é¢„åŠ è½½
3. **å®šæ—¶åˆ·æ–°**ï¼šåˆç†è®¾ç½®åˆ·æ–°é—´éš”ï¼Œé¿å…è¿‡åº¦æŸ¥è¯¢
4. **UIå“åº”**ï¼šè€—æ—¶æ“ä½œåœ¨åå°çº¿ç¨‹æ‰§è¡Œ

### 8.3 æ··åˆæ•°æ®åŠ è½½ç­–ç•¥

**åœ°å›¾é¡µé¢**ï¼š
- é™æ€æ•°æ®ï¼ˆç«™ç‚¹åæ ‡ã€åç§°ï¼‰â†’ ä»JSONæ–‡ä»¶åŠ è½½ï¼ˆæ¯«ç§’çº§ï¼‰
- åŠ¨æ€æ•°æ®ï¼ˆåº“å­˜æ•°é‡ï¼‰â†’ ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆå®æ—¶ï¼‰

**ä¼˜åŠ¿**ï¼š
- é™ä½æ•°æ®åº“I/Oå‹åŠ›
- æå‡é¡µé¢åŠ è½½é€Ÿåº¦
- ä¿è¯æ•°æ®å®æ—¶æ€§

---

## æ€»ç»“

æœ¬ç³»ç»Ÿé‡‡ç”¨**åˆ†å±‚æ¶æ„**è®¾è®¡ï¼Œå‰åç«¯èŒè´£æ¸…æ™°ï¼Œä»£ç ç»“æ„è‰¯å¥½ã€‚åç«¯é€šè¿‡DAOæ¨¡å¼å®ç°æ•°æ®è®¿é—®çš„ç‹¬ç«‹æ€§ï¼ŒServiceå±‚å°è£…ä¸šåŠ¡é€»è¾‘ï¼Œå‰ç«¯é€šè¿‡ä¿¡å·æ§½æœºåˆ¶å®ç°é¡µé¢é—´é€šä¿¡ã€‚ç³»ç»Ÿæ”¯æŒå¤šç»ˆç«¯å¹¶å‘ï¼Œé€šè¿‡çº¿ç¨‹å±€éƒ¨å­˜å‚¨çš„æ•°æ®åº“è¿æ¥æ± ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚æ•´ä½“è®¾è®¡å…¼é¡¾äº†å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
